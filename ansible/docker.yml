---
- name: Docker setup
  hosts: localhost
  vars:
    ansible_python_interpreter: /usr/bin/python3  

  tasks:
    - name: Install apt packages
      become: yes
      apt:
        name: python3-debian

    - name: Add user to docker group
      become: yes
      user:
        name: grig
        groups: docker
        append: yes

    - name: Install geerlingguy.docker 
      ansible.builtin.command:
        cmd: ansible-galaxy install geerlingguy.docker
      run_once: true

    - name: Install docker
      ansible.builtin.include_role:
        name: geerlingguy.docker
      vars:
        docker_install_compose_plugin: true
        docker_install_compose: false

    - name: Start and enable Docker
      become: yes
      systemd:
        name: docker
        state: started
        enabled: yes
